{% load static %}
{% load i18n %}

<!DOCTYPE html>
<html>
  <head>
    <title>Наши путешествия</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.3.1/mapbox-gl.css' rel='stylesheet' />
  </head>
  <body>
    <div id="map" style='width: 100%; height: 100%; position: fixed; top: 0; left: 0;'></div>
    <div id="popup"></div>
    <div id="black-cover" style='width: 100%; height: 100%; position: fixed; top: 0; left: 0;'></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiaWdpdG1hbiIsImEiOiJjazBzNXpkNTYwY29jM25ueGttZXN4eXd6In0.GnYQMVcS3wJq8ZSx9maygQ';
        var map = new mapboxgl.Map({
            container: 'map',
            // style: 'mapbox://styles/mapbox/streets-v11'
            style: 'mapbox://styles/mapbox/satellite-streets-v11',
            zoom: 1,
            // maxZoom
        });

        var data = {
            type: 'FeatureCollection',
            features: [
                {% for record in records %}
                {
                    type: 'Feature',
                    geometry: {
                        type: 'Point',
                        coordinates: [
                            {% language 'en'%}{{ record.lon }}{% endlanguage %},
                            {% language 'en'%}{{ record.lat }}{% endlanguage %},
                        ]
                    },
                    properties: {
                        title: 'Mapbox',
                        description: '{{ record.desc }}',
                        photos: [
                            {% for img in record.travel_images.all %}
                            "{{ img.photo.url }}",
                            {% endfor %}
                        ],
                    }
                },
                {% endfor %}
            ]
        };
        var cover = document.getElementById("black-cover");
        var popup = document.getElementById("popup");

        cover.addEventListener('click', () => {
            cover.style.display = "none";
            popup.style.display = "none";
        });

        data.features.forEach(function(marker) {
            var el = document.createElement('div');
            el.className = 'marker';

            new mapboxgl.Marker(el).setLngLat(marker.geometry.coordinates).addTo(map);
            el.addEventListener('click', () => {
                cover.style.display = "block";
                popup.style.display = "block";
                var inner_html = '<div class="description">';
                inner_html += marker.properties.description;
                inner_html += '</div>';
                popup.innerHTML = inner_html;
            });
        });

    </script>
    <style>
        .description {
            padding: 10px;
        }
        #popup {
            position: relative;
            width: 80%;
            margin: 30px auto;
            min-height: 100px;
            pointer-events: auto;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 0.3rem;
            outline: 0;
            display: none;
            z-index: 10000;
        }
        #black-cover {
            opacity: 0.6;
            background-color: black;
            display: none;
        }

        .marker {
            background-image: url({% static 'map/images/marker.png' %});
            background-size: cover;
            width: 20px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
        }

        .mapboxgl-popup {
            max-width: 200px;
        }

        .mapboxgl-popup-content {
            text-align: center;
            font-family: 'Open Sans', sans-serif;
        }
    </style>
  </body>
</html>